import{d as o,aD as S,aE as v,b6 as w,a3 as F,b7 as N,b8 as R,aG as A,b9 as $,aP as B,ba as P,bb as y,Y as D,e,C as j,b as x,bc as h,J as b,h as q,O as T,F as C,aq as z,bd as L,A as k,H as O,be as V,M as H,B as p,R as m,q as E,f,W as M,T as G,l as W,bf as U,v as _}from"./index-C3oX8Ud1.js";import{a as J,N as K}from"./ListItem-BvChfOl-.js";const Y=Object.assign(Object.assign({},v.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrap:{type:Boolean,default:!0}}),Q=o({name:"Flex",props:Y,setup(t){const{mergedClsPrefixRef:a,mergedRtlRef:r}=S(t),n=v("Flex","-flex",void 0,$,t,a);return{rtlEnabled:w("Flex",r,a),mergedClsPrefix:a,margin:F(()=>{const{size:u}=t;if(Array.isArray(u))return{horizontal:u[0],vertical:u[1]};if(typeof u=="number")return{horizontal:u,vertical:u};const{self:{[B("gap",u)]:s}}=n.value,{row:c,col:i}=P(s);return{horizontal:y(i),vertical:y(c)}})}},render(){const{vertical:t,reverse:a,align:r,inline:n,justify:l,margin:u,wrap:s,mergedClsPrefix:c,rtlEnabled:i}=this,d=N(R(this),!1);return d.length?A("div",{role:"none",class:[`${c}-flex`,i&&`${c}-flex--rtl`],style:{display:n?"inline-flex":"flex",flexDirection:t&&!a?"column":t&&a?"column-reverse":!t&&a?"row-reverse":"row",justifyContent:l,flexWrap:!s||t?"nowrap":"wrap",alignItems:r,gap:`${u.vertical}px ${u.horizontal}px`}},d):null}});function X(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!_(t)}const ue=o({setup(){const t=D();return()=>{const a=t.query.refId;return e(j,null,{default:()=>[a?e(ee,{refId:a},null):e(Z,null,null)]})}}}),Z=o({setup(){const t=x(1),{data:a,mutate:r}=h("/api/ai/summaries",async()=>await m.api.ai.summaries.get({params:{page:t.value}}),{revalidateOnFocus:!1});return()=>a.value?.data.length===0?e(b,null,null):e(C,null,[e(I,{summaries:a.value?.data||[],getArticle:n=>{const l=a.value?.articles[n];if(!l)throw new Error("article not found");return{type:l.type,document:{title:l.title}}},mutate:r},null),e(q,{class:"mt-6",justify:"end"},{default:()=>[e(T,{page:a.value?.pagination.currentPage,pageCount:a.value?.pagination.totalPage,onUpdatePage:n=>{t.value=n,r()}},null)]})])}}),ee=o({props:{refId:{type:String,required:!0}},setup(t){const a=t.refId,{data:r,mutate:n}=h(`/api/ai/summary/${a}`,async()=>await m.api.ai.summaries.ref(a).get()),l=z(),{setHeaderButtons:u}=L();return u(e(O,{icon:e(k,null,null),name:"生成摘要",onClick:()=>{const s=l.create({title:"生成摘要",content(){return e(o({setup(){const i=x(!1);return()=>e("form",{onSubmit:d=>{d.preventDefault(),d.target.querySelector("input[name=lang]")?.value&&(i.value=!0,m.api.ai("generate-summary").post({data:{refId:a}}).then(g=>{g&&r.value?.summaries.push(g),s.destroy()}).finally(()=>{i.value=!1}))}},[e(E,{type:"text",inputProps:{name:"lang"},defaultValue:"zh-CN",placeholder:"目标语言"},null),e("div",{class:"mt-4 text-right"},[e(p,{attrType:"submit",loading:i.value,round:!0,type:"primary"},{default:()=>[f("生成")]})])])}}),null,null)}})}},null)),V(()=>{u(null)}),()=>!r.value||r.value.summaries.length===0?e(b,null,null):e(I,{summaries:r.value?.summaries||[],getArticle:()=>r.value.article,mutate:n},null)}}),I=o({props:{summaries:{type:Array,required:!0},getArticle:{type:Function,required:!0},mutate:{type:Function,required:!0}},setup(t){return()=>{let a;return e(K,{bordered:!0,showDivider:!0},X(a=t.summaries.map(r=>e(J,{class:"ml-2",key:r.id},{suffix(){return e(H,null,{default:()=>[e(p,{onClick:()=>{const n=dialog.create({title:"修改摘要",content(){return e("form",{onSubmit:l=>{l.preventDefault();const s=l.target.querySelector("textarea")?.value;s&&m.api.ai.summaries(r.id).patch({data:{summary:s}}).then(()=>{t.mutate(),n.destroy()})}},[e(Q,{vertical:!0},{default:()=>[e(E,{inputProps:{name:"summary"},rows:6,type:"textarea",defaultValue:r.summary},null),e("div",{class:"text-right"},[e(p,{type:"primary",attrType:"submit",round:!0},{default:()=>[f("保存")]})])]})])}})},round:!0},{default:()=>[f("修改")]}),e(p,{onClick:()=>{const n=dialog.create({title:"确定？",content:"确定要删除吗？",type:"error",positiveText:"删除",negativeText:"取消",onPositiveClick(){m.api.ai.summaries(r.id).delete().then(()=>{t.mutate(),n.destroy()})}})},round:!0,type:"error"},{default:()=>[e(M,null,{default:()=>[e(G,{class:"text-white"},null)]})]})]})},default(){const n=t.getArticle(r.refId);return e(C,null,[e(W,{to:`/${n.type}/edit?id=${r.refId}`},{default:()=>[e("h2",{"data-article-id":r.refId},[n.document.title])]}),e("small",null,[f("目标语言："),r.lang,f(" /")," ",U(new Date(r.created),"yyyy-MM-dd HH:mm")]),e("p",{class:"mt-2"},[r.summary])])}})))?a:{default:()=>[a]})}}});export{ue as default};
